<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ماشین حساب شیشه‌ای حرفه‌ای</title>
<style>
  body {
    background: #1c1c1c;
    font-family: "Segoe UI", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin:0;
    transition: background 0.3s;
  }
  body.light { background: #e0e0e0; }

  .calculator {
    width: 95%;
    max-width: 420px;
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    padding: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: background 0.3s;
  }
  body.light .calculator { background: rgba(255,255,255,0.2); }

  .display {
    color: #fff;
    font-size: 1.8em;
    font-weight: 500;
    text-align: right;
    padding: 12px 10px;
    min-height: 50px;
    border-radius: 12px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.2);
    overflow-x: auto;
    transition: background 0.3s, color 0.3s;
  }
  body.light .display { background: rgba(255,255,255,0.3); color: #000; border: 1px solid rgba(0,0,0,0.2); }

  .history {
    background: rgba(255,255,255,0.05);
    color: #ccc;
    font-size: 0.75em;
    padding: 8px;
    height: 80px;
    overflow-y: auto;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    transition: background 0.3s, color 0.3s, border 0.3s;
  }
  body.light .history { background: rgba(255,255,255,0.3); color: #000; border: 1px solid rgba(0,0,0,0.2); }

  .buttons { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }

  button {
    font-size: 0.9em;
    font-weight: bold;
    border: none;
    border-radius: 12px;
    height: 50px;
    cursor: pointer;
    transition: all 0.05s ease, box-shadow 0.05s ease;
    background: rgba(255,255,255,0.1);
    color: #fff;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    position: relative;
    overflow: hidden;
  }
  body.light button { background: rgba(255,255,255,0.4); color: #000; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
  button:hover { background: rgba(255,255,255,0.2); }
  button:active { transform: scale(0.95); }

  .num { background: rgba(255,255,255,0.05); }
  .op { background: rgba(255,165,0,0.2); color: #fff; }
  .sci { background: rgba(30,144,255,0.2); color: #fff; }
  .mode { background: rgba(138,43,226,0.2); color: #fff; }
  .mem { background: rgba(0,128,0,0.2); color: #fff; }
  .hist { background: rgba(139,0,139,0.2); color: #fff; }
  .util { background: rgba(192,192,192,0.2); color: #000; }
  .eq { background: rgba(255,140,0,0.2); color: #fff; border-radius: 18px; grid-column: span 2; }

  #themeBtn { grid-column: span 4; background: rgba(255,255,255,0.2); color: #fff; }
  body.light #themeBtn { background: rgba(0,0,0,0.1); color: #000; }

  .flash { box-shadow: 0 0 15px 5px rgba(255,255,255,0.7) inset; }
</style>
</head>
<body>
<div class="calculator">
  <div class="display" id="display">0</div>
  <div class="history" id="history"></div>
  <div class="buttons">
    <button class="util">C</button>
    <button class="util">+/-</button>
    <button class="util">%</button>
    <button class="op">÷</button>

    <button class="sci">sin</button>
    <button class="sci">cos</button>
    <button class="sci">tan</button>
    <button class="sci">√</button>

    <button class="sci">log</button>
    <button class="mode" id="mode">Deg</button>
    <button class="mem">M+</button>
    <button class="mem">M-</button>

    <button class="mem">MR</button>
    <button class="mem">MC</button>
    <button class="hist">Hist</button>
    <button class="hist">ClrH</button>

    <button class="num">7</button>
    <button class="num">8</button>
    <button class="num">9</button>
    <button class="op">×</button>

    <button class="num">4</button>
    <button class="num">5</button>
    <button class="num">6</button>
    <button class="op">-</button>

    <button class="num">1</button>
    <button class="num">2</button>
    <button class="num">3</button>
    <button class="op">+</button>

    <button class="num">0</button>
    <button class="num">.</button>
    <button class="eq">=</button>

    <button id="themeBtn">تغییر تم روشن/تیره</button>
  </div>
</div>

<script>
const display = document.getElementById("display");
const historyDiv = document.getElementById("history");
const buttons = document.querySelectorAll("button");
const modeBtn = document.getElementById("mode");
const themeBtn = document.getElementById("themeBtn");

let currentInput = "";
let mode = "Deg";
let memory = 0;
let history = [];

modeBtn.addEventListener("click", () => {
  mode = (mode==="Deg") ? "Rad" : "Deg";
  modeBtn.innerText = mode;
});

themeBtn.addEventListener("click", ()=>{
  document.body.classList.toggle("light");
});

function updateHistory(){
  historyDiv.innerHTML = history.slice(-5).join("<br>");
}

function flash(buttonsArray){
  buttonsArray.forEach(btn=> btn.classList.add("flash"));
  requestAnimationFrame(()=>buttonsArray.forEach(btn=> btn.classList.remove("flash")));
}

buttons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    let val = btn.innerText;

    flash([btn]);

    if(val==="C"){ currentInput=""; }
    else if(val==="="){
      try{
        let exp=currentInput.replace(/×/g,"*").replace(/÷/g,"/");
        let result=eval(exp);
        history.push(currentInput+" = "+result);
        currentInput=result.toString();
        updateHistory();
        flash(buttons);
      }catch{
        currentInput="Error";
        flash(buttons);
      }
    }
    else if(["sin","cos","tan"].includes(val)){
      try{
        let angle=parseFloat(currentInput);
        if(isNaN(angle)){currentInput="Error"; flash(buttons);}
        else{
          let rad=(mode==="Deg")? angle*Math.PI/180 : angle;
          if(val==="sin") currentInput=Math.sin(rad).toFixed(6);
          if(val==="cos") currentInput=Math.cos(rad).toFixed(6);
          if(val==="tan") currentInput=Math.tan(rad).toFixed(6);
        }
      }catch{ currentInput="Error"; flash(buttons); }
    }
    else if(val==="√"){ 
      let num=parseFloat(currentInput); 
      currentInput=isNaN(num)?"Error":Math.sqrt(num).toFixed(6); 
    }
    else if(val==="log"){ 
      let num=parseFloat(currentInput); 
      currentInput=(isNaN(num)||num<=0)?"Error":Math.log10(num).toFixed(6); 
    }
    else if(val==="+/-"){ currentInput=currentInput.startsWith("-")?currentInput.slice(1):"-"+currentInput; }
    else if(val==="M+") memory+=parseFloat(currentInput)||0;
    else if(val==="M-") memory-=parseFloat(currentInput)||0;
    else if(val==="MR") currentInput=memory.toString();
    else if(val==="MC") memory=0;
    else if(val==="Hist") alert("تاریخچه:\n"+history.join("\n"));
    else if(val==="ClrH"){ history=[]; updateHistory(); }
    else if(val!=="Deg" && val!=="Rad" && val!=="تغییر تم روشن/تیره"){ 
      currentInput=(currentInput==="0" || currentInput==="Error") ? "" : currentInput + val; 
    }

    display.innerText=currentInput||"0";
  });
});
</script>
</body>
</html>