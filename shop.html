<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>To-Do خوشگل (نسخه نهایی)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<style>
:root{
  --bg:#f0f2f5; --text:#222; --header:#ff4b5c; --list:#fff;
  --done:#d4edda; --high:#ffebee; --medium:#fff8e1; --low:#e1f5fe;
}
body.dark{ --bg:#141414; --text:#eee; --header:#ff4b5c; --list:#222; --done:#2e7d32; --high:#ff8a80; --medium:#ffe57f; --low:#81d4fa; }
*{box-sizing:border-box;font-family:Tahoma,Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);transition:background .25s,color .25s;}
header{position:fixed;top:0;left:0;right:0;height:64px;background:var(--header);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:120;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.12)}
.header-left{display:flex;align-items:center;gap:12px}
.header-title{font-weight:600;display:flex;align-items:center;gap:8px}
.header-actions button{background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer;padding:8px;border-radius:8px}
.container{max-width:900px;margin:90px auto 40px;padding:0 12px;display:flex;gap:18px;flex-direction:column}
.list{background:var(--list);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.06);transition:box-shadow .25s}
.list h3{margin:0 0 12px 0;color:var(--header);display:flex;align-items:center;gap:10px}
.filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.filters select{padding:8px;border-radius:8px;border:1px solid #d6d6d6;background:transparent}
.add-item{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.add-item input,.add-item select{padding:10px;border-radius:10px;border:1px solid #ddd}
.add-item button{padding:10px;border-radius:10px;border:0;background:var(--header);color:#fff;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
ul{list-style:none;padding:0;margin:0;min-height:70px}
li{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:12px;background:#fafafa;margin-bottom:10px;box-shadow:0 4px 14px rgba(2,6,23,0.03);transition:transform .18s,box-shadow .18s,opacity .18s}
li:hover{transform:translateY(-4px)}
li.dragging{opacity:.45;transform:scale(.98)}
li.done{background:var(--done);text-decoration:line-through;color:#666}
.item-left{display:flex;align-items:center;gap:12px;min-width:0}
.item-text{font-size:15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.item-meta{font-size:12px;color:#666}
.item-actions button{background:transparent;border:0;cursor:pointer;padding:6px;border-radius:8px}
.priority-high{background:var(--high)}
.priority-medium{background:var(--medium)}
.priority-low{background:var(--low)}

/* Sidebar + overlay */
.sidebar{
  position:fixed;top:0;left:-320px;height:100%;width:280px;
  background:linear-gradient(160deg,var(--list) 0%,#f8f9fa 100%);
  box-shadow:2px 0 25px rgba(0,0,0,.15);
  padding:20px;z-index:130;border-top-right-radius:16px;border-bottom-right-radius:16px;
  transition:left .35s cubic-bezier(0.4, 0, 0.2, 1);
}
.sidebar.open{left:0;}
.sidebar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.sidebar-header h3{margin:0;font-size:18px;color:var(--header);display:flex;align-items:center;gap:8px}
.close-sidebar{background:transparent;border:0;font-size:20px;cursor:pointer;color:#666;transition:.2s}
.close-sidebar:hover{color:var(--header);transform:rotate(90deg)}
.theme-options{display:flex;gap:14px;flex-wrap:wrap;justify-content:flex-start}
.theme-circle{
  width:42px;height:42px;border-radius:50%;cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.12);transition:transform .2s,box-shadow .2s
}
.theme-circle:hover{transform:scale(1.15);box-shadow:0 6px 16px rgba(0,0,0,.18)}
.theme-circle.default{background:linear-gradient(135deg,#ff4b5c,#ff6b81);}
.theme-circle.blue{background:linear-gradient(135deg,#2196f3,#64b5f6);}
.theme-circle.green{background:linear-gradient(135deg,#4caf50,#81c784);}
.theme-circle.orange{background:linear-gradient(135deg,#ff9800,#ffb74d);}

/* Overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);z-index:125;display:none;backdrop-filter:blur(2px)}
.overlay.active{display:block;animation:fadeIn .3s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* responsive */
@media (min-width:900px){
  .container{flex-direction:row;align-items:flex-start}
  .list{flex:1}
}
@media (max-width:600px){
  header{height:56px}
  .header-title{font-size:14px}
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <button id="menuBtn" aria-label="باز/بسته کردن منو"><i class="fa-solid fa-palette"></i></button>
    <div class="header-title"><i class="fa-solid fa-list-check"></i><span>To-Do خوشگل</span></div>
  </div>
  <div class="header-actions">
    <button id="themeToggle" aria-label="تاریک / روشن"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<div class="overlay" id="overlay"></div>

<div class="sidebar" id="sidebar" aria-hidden="true">
  <div class="sidebar-header">
    <h3><i class="fa-solid fa-palette"></i> انتخاب تم</h3>
    <button id="closeSidebar" class="close-sidebar"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="theme-options">
    <div class="theme-circle default" onclick="setTheme('default')" title="پیش‌فرض"></div>
    <div class="theme-circle blue" onclick="setTheme('blue')" title="آبی"></div>
    <div class="theme-circle green" onclick="setTheme('green')" title="سبز"></div>
    <div class="theme-circle orange" onclick="setTheme('orange')" title="نارنجی"></div>
  </div>
</div>

<div class="container">
  <!-- Daily -->
  <div class="list" id="daily-list">
    <h3><i class="fa-solid fa-calendar-day"></i> روزانه</h3>
    <div class="filters">
      <select id="daily-filter-status" onchange="applyFilters('daily')">
        <option value="all">همه</option>
        <option value="done">انجام‌شده</option>
        <option value="undone">انجام‌نشده</option>
      </select>
      <select id="daily-filter-priority" onchange="applyFilters('daily')">
        <option value="all">همه اولویت‌ها</option>
        <option value="high">مهم</option>
        <option value="medium">متوسط</option>
        <option value="low">کم</option>
      </select>
    </div>
    <ul id="daily-items"></ul>
    <div class="add-item">
      <input id="daily-input" placeholder="کار جدید..." />
      <input id="daily-date" type="datetime-local" />
      <select id="daily-priority">
        <option value="low">کم</option>
        <option value="medium">متوسط</option>
        <option value="high">مهم</option>
      </select>
      <button id="daily-add">افزودن به روزانه</button>
    </div>
  </div>

  <!-- Important -->
  <div class="list" id="important-list">
    <h3><i class="fa-solid fa-bolt"></i> مهم / فوری</h3>
    <div class="filters">
      <select id="important-filter-status" onchange="applyFilters('important')">
        <option value="all">همه</option>
        <option value="done">انجام‌شده</option>
        <option value="undone">انجام‌نشده</option>
      </select>
      <select id="important-filter-priority" onchange="applyFilters('important')">
        <option value="all">همه اولویت‌ها</option>
        <option value="high">مهم</option>
        <option value="medium">متوسط</option>
        <option value="low">کم</option>
      </select>
    </div>
    <ul id="important-items"></ul>
    <div class="add-item">
      <input id="important-input" placeholder="کار جدید..." />
      <input id="important-date" type="datetime-local" />
      <select id="important-priority">
        <option value="low">کم</option>
        <option value="medium">متوسط</option>
        <option value="high">مهم</option>
      </select>
      <button id="important-add">افزودن به مهم</button>
    </div>
  </div>
</div>

<script>
let draggedItem = null;
/* Sidebar toggle */
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const menuBtn = document.getElementById('menuBtn');
const closeSidebarBtn = document.getElementById('closeSidebar');
menuBtn.addEventListener('click', toggleSidebar);
closeSidebarBtn.addEventListener('click', closeSidebar);
overlay.addEventListener('click', closeSidebar);
function toggleSidebar(){
  const open = sidebar.classList.toggle('open');
  overlay.classList.toggle('active', open);
  sidebar.setAttribute('aria-hidden', String(!open));
}
function closeSidebar(){
  sidebar.classList.remove('open');
  overlay.classList.remove('active');
  sidebar.setAttribute('aria-hidden', 'true');
}
/* Theme system */
function setTheme(color){
  const root=document.documentElement;
  if(color==='blue'){
    root.style.setProperty('--header','#2196f3');
    root.style.setProperty('--high','#bbdefb');
    root.style.setProperty('--medium','#90caf9');
    root.style.setProperty('--low','#e3f2fd');
  }else if(color==='green'){
    root.style.setProperty('--header','#4caf50');
    root.style.setProperty('--high','#c8e6c9');
    root.style.setProperty('--medium','#a5d6a7');
    root.style.setProperty('--low','#e8f5e9');
  }else if(color==='orange'){
    root.style.setProperty('--header','#ff9800');
    root.style.setProperty('--high','#ffe0b2');
    root.style.setProperty('--medium','#ffcc80');
    root.style.setProperty('--low','#fff3e0');
  }else{
    root.style.setProperty('--header','#ff4b5c');
    root.style.setProperty('--high','#ffebee');
    root.style.setProperty('--medium','#fff8e1');
    root.style.setProperty('--low','#e1f5fe');
  }
  localStorage.setItem('todo_theme', color);
}
document.getElementById('themeToggle').addEventListener('click',()=>{
  document.body.classList.toggle('dark');
  localStorage.setItem('todo_dark',document.body.classList.contains('dark')?'1':'0');
});
/* Notification */
function notify(item){
  if(!item||!item.dataset.date) return;
  const date=new Date(item.dataset.date);
  const now=new Date();
  const diff=date-now;
  if(diff>0&&diff<60000&&Notification.permission==="granted"){
    new Notification("سررسید",{body:item.querySelector('.text').textContent});
  }
}
/* Save/Load */
function saveData(){
  ['daily','important'].forEach(list=>{
    const data=[...document.querySelectorAll(`#${list}-items li`)].map(li=>({
      text:li.querySelector('.text').textContent,
      date:li.dataset.date,
      priority:li.dataset.priority,
      done:li.dataset.done==='true'
    }));
    localStorage.setItem(`todo_${list}`,JSON.stringify(data));
  });
}
function loadData(){
  ['daily','important'].forEach(list=>{
    const cont=document.getElementById(`${list}-items`);
    cont.innerHTML='';
    const raw=localStorage.getItem(`todo_${list}`);
    if(!raw) return;
    JSON.parse(raw).forEach(it=>addItem(list,it.text,it.date,it.priority,it.done,true));
  });
  const theme=localStorage.getItem('todo_theme')||'default';
  setTheme(theme);
  if(localStorage.getItem('todo_dark')==='1') document.body.classList.add('dark');
}
/* Add item */
function addItem(list,text=null,date=null,priority=null,done=false,skipSave=false){
  const input=document.getElementById(`${list}-input`);
  const dateInput=document.getElementById(`${list}-date`);
  const prInput=document.getElementById(`${list}-priority`);
  const value=(text!==null)?String(text):(input.value||'').trim();
  if(!value) return;
  const li=document.createElement('li');
  li.className=`priority-${priority||prInput.value||'low'}`;
  li.dataset.date=date||dateInput.value||'';
  li.dataset.priority=priority||prInput.value||'low';
  li.dataset.done=done?'true':'false';
  if(done) li.classList.add('done');
  const left=document.createElement('div');left.className='item-left';
  const span=document.createElement('span');span.className='text';span.textContent=value;
  left.appendChild(span);
  const meta=document.createElement('div');meta.className='item-meta';
  meta.textContent=li.dataset.date?` ${new Date(li.dataset.date).toLocaleString()}`:'';
  left.appendChild(meta);
  const actions=document.createElement('div');actions.className='item-actions';
  const doneBtn=document.createElement('button');doneBtn.innerHTML='<i class="fa-solid fa-check"></i>';
  doneBtn.onclick=()=>{li.dataset.done=li.dataset.done==='true'?'false':'true';li.classList.toggle('done');applyFilters(list);saveData();};
  const delBtn=document.createElement('button');delBtn.innerHTML='<i class="fa-solid fa-trash"></i>';
  delBtn.onclick=()=>{li.remove();saveData();};
  actions.appendChild(doneBtn);actions.appendChild(delBtn);
  li.appendChild(left);li.appendChild(actions);
  addDrag(li);
  document.getElementById(`${list}-items`).appendChild(li);
  if(text===null){input.value='';dateInput.value='';prInput.value='low';}
  applyFilters(list);
  if(!skipSave) saveData();
  notify(li);
}
/* Drag & drop */
function addDrag(li){
  li.draggable=true;
  li.addEventListener('dragstart',()=>{draggedItem=li;li.classList.add('dragging');});
  li.addEventListener('dragend',()=>{draggedItem=null;li.classList.remove('dragging');saveData();});
}
function getDragAfterElement(cont,y){
  const els=[...cont.querySelectorAll('li:not(.dragging)')];
  let closest={offset:Number.NEGATIVE_INFINITY,element:null};
  els.forEach(child=>{
    const box=child.getBoundingClientRect();
    const offset=y-box.top-box.height/2;
    if(offset<0&&offset>closest.offset) closest={offset,element:child};
  });
  return closest.element;
}
/* Filters */
function applyFilters(list){
  const status=document.getElementById(`${list}-filter-status`).value;
  const priority=document.getElementById(`${list}-filter-priority`).value;
  [...document.querySelectorAll(`#${list}-items li`)].forEach(item=>{
    let show=true;
    if(status==='done'&&item.dataset.done!=='true') show=false;
    if(status==='undone'&&item.dataset.done!=='false') show=false;
    if(priority!=='all'&&item.dataset.priority!==priority) show=false;
    item.style.display=show?'flex':'none';
  });
}
/* Init */
window.addEventListener('DOMContentLoaded',()=>{
  document.querySelectorAll('ul').forEach(ul=>{
    ul.addEventListener('dragover',e=>{
      e.preventDefault();
      if(!draggedItem) return;
      const after=getDragAfterElement(ul,e.clientY);
      if(!after) ul.appendChild(draggedItem);
      else ul.insertBefore(draggedItem,after);
    });
  });
  [['daily','daily-add'],['important','important-add']].forEach(([list,btnId])=>{
    document.getElementById(btnId).addEventListener('click',()=>addItem(list));
  });
  loadData();
  if("Notification" in window && Notification.permission!=="granted"){
    Notification.requestPermission();
  }
  setInterval(()=>{
    ['daily','important'].forEach(list=>{
      document.querySelectorAll(`#${list}-items li`).forEach(notify);
    });
  },60000);
});
</script>

</body>
</html>