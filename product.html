<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„ ğŸŒ¸</title>
<style>
body{margin:0;font-family:Tahoma,sans-serif;background:#fff8fb;padding:12px;color:#222;}
h1,h2{color:#ff5b93;}
.container{max-width:720px;margin:auto;display:flex;flex-direction:column;gap:12px;}
img{width:100%;border-radius:12px;object-fit:cover;}
.price{font-weight:bold;color:#ff5b93;font-size:1.1rem;}
.stock{color:#666;font-size:13px;}
button,.btn{padding:8px 12px;border:none;border-radius:8px;background:#ff5b93;color:#fff;cursor:pointer;transition:0.25s;text-decoration:none;}
button:hover,.btn:hover{background:#ff357f;}
textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;font-family:Tahoma;resize:none;}
.comment-list{list-style:none;padding:0;margin:0;}
.comment-list li{border-bottom:1px dashed #eee;padding:6px 0;font-size:13px;}
.actions{display:flex;gap:8px;flex-wrap:wrap;}
.similar-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;margin-top:12px;}
.similar-card{background:#fff;padding:8px;border-radius:8px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.12);}
.similar-card img{width:100%;height:100px;object-fit:cover;border-radius:6px;}
</style>
</head>
<body>
<div class="container">
  <h1 id="productName">Ù…Ø­ØµÙˆÙ„</h1>
  <img id="productImage" src="" alt="Ù…Ø­ØµÙˆÙ„">
  <div class="price" id="productPrice">Û° ØªÙˆÙ…Ø§Ù†</div>
  <div class="stock" id="productStock">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: 0</div>
  <div id="productDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„...</div>

  <h2>Ù†Ø¸Ø±Ø§Øª</h2>
  <ul id="commentList" class="comment-list"></ul>
  <textarea id="newComment" rows="3" placeholder="Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
  <button id="addCommentBtn">Ø«Ø¨Øª Ù†Ø¸Ø±</button>

  <div class="actions">
    <button id="addToCartBtn">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
    <a href="cart.html" id="showCartBtn" class="btn">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</a>
    <a href="shop.html" class="btn">ğŸ¬ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</a>
  </div>

  <h2>Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡</h2>
  <div id="similarProducts" class="similar-grid"></div>
</div>

<script>
// --- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ---
let products = JSON.parse(localStorage.getItem("products")||"[]");
let cart = JSON.parse(localStorage.getItem("cart")||"[]");
const urlParams = new URLSearchParams(window.location.search);
const prodId = urlParams.get("id");
const product = products.find(p=>p.id===prodId);

// --- Ú©Ù…Ú©ÛŒ: ÙÙ‚Ø· Ø§Ø³Ù… ÙØ§ÛŒÙ„ Ø¹Ú©Ø³ Ø±Ùˆ Ø¨Ú¯ÛŒØ± ---
function getImageFile(path){
  if(!path) return "";
  return path.split("/").pop(); // ÙÙ‚Ø· Ø§Ø³Ù… ÙØ§ÛŒÙ„
}

// --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„ ---
if(product){
  document.getElementById("productName").textContent = product.name;
  document.getElementById("productImage").src = getImageFile(product.image);
  document.getElementById("productPrice").textContent = product.price.toLocaleString()+" ØªÙˆÙ…Ø§Ù†";
  document.getElementById("productStock").textContent = "Ù…ÙˆØ¬ÙˆØ¯ÛŒ: "+product.stock;
  document.getElementById("productDescription").textContent = product.description||"ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„...";
}

// --- Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ---
document.getElementById("addToCartBtn").addEventListener("click",()=>{
  if(product.stock>0){
    cart.push({...product});
    product.stock--;
    localStorage.setItem("cart",JSON.stringify(cart));
    localStorage.setItem("products",JSON.stringify(products));
    document.getElementById("productStock").textContent = "Ù…ÙˆØ¬ÙˆØ¯ÛŒ: "+product.stock;
    alert("Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!");
    displaySimilarProducts();
  } else {
    alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
  }
});

// --- Ù†Ø¸Ø±Ø§Øª ---
let comments = ["Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯ ğŸ˜","Ø±Ø§Ø¶ÛŒ Ø¨ÙˆØ¯Ù… ğŸ‘","Ú©ÛŒÙÛŒØª Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø±Ù‡"];
function displayComments(){
  const list = document.getElementById("commentList");
  list.innerHTML = "";
  comments.forEach(c=>{
    const li = document.createElement("li");
    li.textContent = c;
    list.appendChild(li);
  });
}
displayComments();
document.getElementById("addCommentBtn").addEventListener("click",()=>{
  const val = document.getElementById("newComment").value.trim();
  if(val){comments.push(val);document.getElementById("newComment").value="";displayComments();}
});

// --- Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡ ---
function displaySimilarProducts(){
  const similarContainer = document.getElementById("similarProducts");
  similarContainer.innerHTML = "";
  products.filter(p=>p.category===product.category && p.id!==product.id).forEach(p=>{
    const card = document.createElement("div");
    card.className="similar-card";
    card.innerHTML=`
      <img src="${getImageFile(p.image)}" alt="${p.name}">
      <div>${p.name}</div>
      <div class="price">${p.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
      <div class="stock">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${p.stock}</div>
      <button ${p.stock===0?'disabled':''} onclick="addSimilarToCart('${p.id}')">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯</button>
    `;
    similarContainer.appendChild(card);
  });
}
displaySimilarProducts();

// --- Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ù‡ Ø³Ø¨Ø¯ ---
function addSimilarToCart(id){
  const p = products.find(pr=>pr.id===id);
  if(p && p.stock>0){
    cart.push({...p});
    p.stock--;
    localStorage.setItem("cart",JSON.stringify(cart));
    localStorage.setItem("products",JSON.stringify(products));
    displaySimilarProducts();
    alert("Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!");
  } else {
    alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
  }
}
</script>
</body>
</html>